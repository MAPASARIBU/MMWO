<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= typeof title !=='undefined' ? title + ' - MMWO' : 'MMWO System' %>
    </title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                MMWO System
            </div>
            <ul class="nav-links">
                <li class="nav-item">
                    <a href="/dashboard" class="<%= path === '/dashboard' ? 'active' : '' %>">
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/work-orders" class="<%= path && path.startsWith('/work-orders') ? 'active' : '' %>">
                        Work Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/weekly-plan" class="<%= path === '/weekly-plan' ? 'active' : '' %>">
                        Weekly Plan
                    </a>
                </li>
                <% if (user && user.role==='ADMIN' ) { %>
                    <li class="nav-item">
                        <a href="/admin/users" class="<%= path === '/admin/users' ? 'active' : '' %>">
                            User Management
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admin/master" class="<%= path === '/admin/master' ? 'active' : '' %>">
                            Master Data
                        </a>
                    </li>
                    <% } %>
            </ul>
            <div class="user-info">
                <div>
                    <%= user.name %>
                </div>
                <small>
                    <%= user.role %> | <%= user.current_mill_name || (user.mill_id ? 'Mill ' + user.mill_id
                            : 'All Mills' ) %>
                </small>
                <div style="margin-top: 0.5rem;">
                    <a href="/auth/logout" style="color: #ef4444; padding: 0;">Logout</a>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <button class="menu-toggle" aria-label="Toggle Navigation">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="page-title">
                    <h2>
                        <%= typeof title !=='undefined' ? title : '' %>
                            <% if (typeof user !=='undefined' && (user.current_mill_name || user.mill_id)) { %>
                                <span style="font-size: 0.8em; color: #666; margin-left: 10px;">
                                    - <%= user.current_mill_name || ('Mill ' + user.mill_id) %>
                            </span>
                        <% } %>
                    </h2>
                </div>
                <div class="actions">
                    <!-- Global Actions can go here -->
                </div>
            </header>

            <div class="page-content">
                <%- body %>
            </div>
        </main>
    </div>

    <script>
        <script>
        // Sidebar toggle for mobile
            const menuToggle = document.querySelector(' .menu-toggle'); const sidebar=document.querySelector('.sidebar');
            const overlay=document.createElement('div'); overlay.className='sidebar-overlay'
            ; document.body.appendChild(overlay); function toggleSidebar() {
                sidebar.classList.toggle('open'); overlay.classList.toggle('show'); } if
            (menuToggle) {menuToggle.addEventListener('click', toggleSidebar); } // Close
            sidebar when clicking overlay overlay.addEventListener('click', toggleSidebar);
                                        // Close sidebar when clicking a link (optional, for better UX) const
                                        navLinks=document.querySelectorAll('.nav-item a'); navLinks.forEach(link=> {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) { toggleSidebar(); }
                }); }); </script>
</body>

</html>